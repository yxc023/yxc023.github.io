buildscript {
    repositories {
      maven {
        url "http://maven.aliyun.com/nexus/content/groups/public"
      }
    }
}

plugins {
    id 'org.jbake.site' version '5.0.0'
    id 'org.ajoberstar.git-publish' version '2.1.3'
}

jbake {
    version  = '2.6.4'
    srcDirName  = 'src/jbake'
    destDirName = "$buildDir/jabke"
}
bakePreview {
    input = project.file('build/gitPublish')
}


gitPublish {
    // where to publish to (repo must exist)
    repoUri = 'git@github.com:yxc023/yxc023.github.io.git'
    // repoUri = 'git@e.coding.net:yxc023/blog.yangxiaochen.com.git'
    // (or 'https://github.com/ajoberstar/test-repo.git', depending on authentication)

    // branch will be created if it doesn't exist
    branch = 'master'

    // generally, you don't need to touch this
    // repoDir = file("$buildDir/jbake") // defaults to $buildDir/gitPublish

    // what to publish, this is a standard CopySpec
    // contents {
    //     from "$buildDir/jabke"
    // }

    // what to keep in the existing branch (include=keep)
    preserve {
        // include '1.0.0/**'
        include 'CNAME'
        include 'bdunion.txt'
        include 'ads.txt'
        include 'jd_root.txt'
    }

    // message used when committing changes
    // commitMessage = 'Publishing a new page' // defaults to 'Generated by gradle-git-publish'
}


bake {
    output file("$buildDir/gitPublish")
    dependsOn gitPublishReset
    // jvmArgs = ["-XX:MaxMetaspaceSize=1g"]
}
gitPublishCommit.dependsOn bake